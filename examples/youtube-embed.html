<html>
  <head>
  </head>
  <body>
    <div id='hapyak-editor'></div>
    <script type="text/javascript">
      function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
        var regexS = "[\\?&]" + name + "=([^&#]*)";
        var regex = new RegExp(regexS);
        var results = regex.exec(window.parent.location.search);
        if(results == null)
          return null;
        else
          return decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      var HapyakViewerConfig = {
        apiKey: "",
        trackId: 2101,
        assets: 'http://hapyak-assets.s3.amazonaws.com/js',
        api: 'http://hapyak.com',
        logLevel: 'info',
        debug: false
      },
      mode = getParameterByName('mode') || 'staging',
      scr = '/hapyak.gz.js';

      if (mode === 'dev') {
        HapyakViewerConfig.assets = '/js';
        HapyakViewerConfig.api = 'http://dev.hapyak.com';
        HapyakViewerConfig.logLevel = 'debug';
        HapyakViewerConfig.debug = true;
        scr = '/hapyak.js';
      } else if (mode === 'staging') {
        HapyakViewerConfig.assets = 'http://hapyak-staging-assets.s3.amazonaws.com/js';
        HapyakViewerConfig.api = 'http://staging.hapyak.com';
      } else if (mode === 'feature') {
        HapyakViewerConfig.assets = 'http://hapyak-feature-assets.s3.amazonaws.com/js';
        HapyakViewerConfig.api = 'http://feature.hapyak.com';
      }

      document.write('<' + 'script src="' + HapyakViewerConfig.api + HapyakViewerConfig.assets + scr + '" type="text/javascript"><' + '/script>');
    </script>
    <script>
      var hapyakEditor = hapyak.editor({
        elementId: 'hapyak-editor',
        width: 560,
        videoId: 356566,
        trackId: 1068,
        css: 'http://modernizr.com/i/css/modernizr-2.1.1.css?v=1',
        onLoadTrack: function (p) {
          console.log('hapyak.editor.onLoadTrack reported to parent page [' + p.videoId + ', ' + p.trackId + ']');
        },
        onLoadCurrentUser: function (p) {
          console.log('hapyak.editor.onLoadCurrentUser reported to parent page [' + p.userId + ', ' + p.username + ']');
        },
        onNewTrack: function (trackId) {
          console.log('hapyak.editor.onNewTrack reported to parent page [' + trackId + ']');
        },
        onSave: function (trackId) {
          console.log('hapyak.editor.onSave reported to parent page [' + trackId + ']');
        },
        onLoad: function () {
          console.log('hapyak.editor.onLoad reported to parent page');
        }
      });
    </script>
  </body>
</html>
